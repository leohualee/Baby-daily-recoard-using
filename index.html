<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‘¶ å¯¶å¯¶æ—¥èªŒ</title>
    <style>
        /* CSS æ¨£å¼ï¼šç¾åŒ–èˆ‡çµæ§‹åŒ– */
        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', Arial, sans-serif;
            margin: 20px;
            background-color: #f4f7f6;
            color: #333;
        }

        h1 {
            color: #5d7596;
            text-align: center;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
        }

        h2 {
            color: #333;
            margin-top: 30px;
        }

        .controls {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: flex-end;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 5px;
            font-weight: 600;
            color: #5d7596;
        }

        input[type="date"], button {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        button {
            background-color: #72a0c6;
            color: white;
            cursor: pointer;
            border: none;
            transition: background-color 0.3s;
            min-width: 150px;
        }

        button:hover {
            background-color: #5d7596;
        }
        
        #status-message {
            margin-left: 20px;
            font-weight: bold;
            color: #4CAF50;
            align-self: flex-end;
            padding-bottom: 10px;
        }

        /* è³‡æ–™é¡¯ç¤ºå€å¡Š */
        #log-output {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 30px; /* å¢åŠ é–“è· */
        }

        .log-card {
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s;
            overflow: hidden; /* ç¢ºä¿åœ“è§’æ•ˆæœ */
        }

        .log-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }

        .card-header {
            padding: 15px 20px;
            background-color: #72a0c6;
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header .date-time {
            font-size: 0.9em;
            font-weight: normal;
            opacity: 0.9;
        }

        .log-content {
            padding: 15px 20px;
        }

        .log-section {
            border-left: 4px solid #f0f0f0;
            padding: 10px 0 10px 15px;
            margin-bottom: 15px;
        }

        .log-section h4 {
            margin-top: 0;
            margin-bottom: 5px;
            font-size: 1em;
            color: #5d7596;
            display: flex;
            align-items: center;
        }
        
        .log-section h4 span {
            margin-right: 8px;
            font-size: 1.2em; /* è®“åœ–æ¨™å¤§ä¸€é» */
        }

        /* é¡è‰²ä¸»é¡Œ */
        .feeding-theme { border-left-color: #ffc107; }
        .sleeping-theme { border-left-color: #17a2b8; }
        .diaper-theme { border-left-color: #28a745; }
        .health-theme { border-left-color: #dc3545; }
        .contact-theme { border-left-color: #6c757d; } /* æ–°å¢è¯çµ¡äº‹é …ä¸»é¡Œ */

        .detail-row {
            display: flex;
            flex-wrap: wrap;
            gap: 5px 20px;
            font-size: 0.9em;
            color: #555;
            margin-top: 5px;
        }

        .detail-item {
            min-width: 45%; 
        }

        .detail-item strong {
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>

    <h1>ğŸš€ å¯¶å¯¶æ—¥èªŒ</h1>

    <div class="controls">
        <div class="control-group">
            <label for="start-date">èµ·å§‹æ—¥æœŸ</label>
            <input type="date" id="start-date">
        </div>

        <div class="control-group">
            <label for="end-date">çµæŸæ—¥æœŸ</label>
            <input type="date" id="end-date">
        </div>

        <button onclick="filterAndDisplayLogs()">ç¯©é¸ä¸¦é¡¯ç¤ºæ—¥èªŒ</button>
        <span id="status-message">æ­£åœ¨é€£ç·šè‡³ Google ç²å–æœ€æ–°è³‡æ–™...</span>
    </div>

    <h2>æ—¥èªŒè¨˜éŒ„</h2>
    <div id="log-output">
        <p>è³‡æ–™è¼‰å…¥å®Œæˆå¾Œï¼Œæœƒè‡ªå‹•é¡¯ç¤ºä»Šæ—¥è¨˜éŒ„ã€‚</p>
    </div>

    <script>
        // å„²å­˜è§£æå¾Œçš„è³‡æ–™
        let babyLogs = [];
                
        // ***************************************************************
        // *** Apps Script æœå‹™çš„ç¶²é æ‡‰ç”¨ç¨‹å¼ URL ***
        // ***************************************************************
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz6iRf6hMgf_jD-Jj9wOCnTVgP3jML8s10fcM7AF2gsblJjTbTcZIJ1RxNFrQzCWFZXZA/exec'; 
                
        const statusMessage = document.getElementById('status-message');

        /**
         * ä¿®æ­£æ—¥æœŸé¸æ“‡æ™‚çš„æ™‚å€åç§»ã€‚
         * å»ºç«‹ä¸€å€‹ä¸å—ç€è¦½å™¨æ™‚å€è‡ªå‹•åç§»å½±éŸ¿çš„æ—¥æœŸç‰©ä»¶ï¼Œç¢ºä¿å®ƒä»£è¡¨è©²æ—¥æœŸçš„æœ¬åœ°åˆå¤œã€‚
         */
        function parseDateForComparison(dateString) {
            if (!dateString) return null;
            
            const parts = dateString.split('-');
            const year = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10) - 1; // æœˆä»½å¾ 0 é–‹å§‹ (0-11)
            const day = parseInt(parts[2], 10);
            
            // å»ºç«‹ä¸€å€‹ Local Time (æœ¬åœ°æ™‚å€) çš„æ—¥æœŸç‰©ä»¶ï¼Œç¢ºä¿æ˜¯è©²å¤©çš„ 00:00:00
            const localDate = new Date(year, month, day, 0, 0, 0, 0); 

            if (isNaN(localDate.getTime())) return null;
            return localDate;
        }

        /**
         * æœ€çµ‚ä¿®æ­£ç‰ˆï¼šæ ¹é™¤ 38 åˆ†é˜æ™‚å€åç§»å•é¡Œã€‚
         * å°ç´”æ™‚é–“æ¬„ä½ï¼ˆä¾‹å¦‚ 08:00ï¼‰å‰‡ç›´æ¥å¾å­—ä¸²ä¸­æå– HH:MMã€‚
         */
        function extractTime(dateString) {
            if (!dateString) return '';
            const str = String(dateString).trim();

            // Case 1: Apps Script Date Object (Time-only columns) - ä¿®æ­£ 38 åˆ†é˜éŒ¯èª¤
            if (str.includes("GMT") || str.includes("CST") || str.includes("1899")) {
                // ç›´æ¥å¾å­—ä¸²ä¸­æå– HH:MM
                const timeMatch = str.match(/(\d{2}):(\d{2}):(\d{2})/);
                if (timeMatch && timeMatch.length >= 3) {
                    return `${timeMatch[1]}:${timeMatch[2]}`; 
                }
            }
            
            // Case 2: Apps Script Timestamp (Column A) - å®Œæ•´çš„æ—¥æœŸæ™‚é–“
            if (str.length > 15 && (str.includes('-') || str.includes(' ') && str.includes('20'))) {
                const d = new Date(str);
                if (!isNaN(d.getTime())) {
                    // å°æ–¼æ™‚é–“æˆ³è¨˜ï¼Œä¾è³´ç€è¦½å™¨çš„æ™‚å€è½‰æ›
                    return d.toLocaleTimeString('zh-TW', { 
                        hour: '2-digit', 
                        minute: '2-digit', 
                        hour12: false 
                    });
                }
            }

            // Case 3: Simple HH:MM (Fallback foræ–‡å­—è¼¸å…¥)
            if (str.match(/^\d{1,2}:\d{2}/)) {
                return str.substring(0, 5);
            }
            
            return ''; 
        }


        // 1. è¼‰å…¥è³‡æ–™ï¼šå¾ Apps Script URL ç²å– JSON è³‡æ–™
        function loadBabyLogs() {
            statusMessage.textContent = 'æ­£åœ¨å¾é›²ç«¯ç²å–æœ€æ–°æ—¥èªŒè³‡æ–™...';
            statusMessage.style.color = '#d9534f';

            const cacheBusterUrl = `${APPS_SCRIPT_URL}?v=${new Date().getTime()}`;

            fetch(cacheBusterUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP éŒ¯èª¤! ç‹€æ…‹ç¢¼: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.error) {
                        statusMessage.textContent = `Apps Script éŒ¯èª¤: ${data.error}`;
                        return;
                    }
                    
                    babyLogs = data.map(log => {
                        const fullTimestamp = String(log['æ™‚é–“æˆ³è¨˜']);
                        // é€™è£¡ä½¿ç”¨å…§å»ºçš„ Date è½‰æ›ä¾†ç²å–é¡¯ç¤ºçš„æ—¥æœŸéƒ¨åˆ†
                        const parsedDate = new Date(fullTimestamp); 
                        const datePart = isNaN(parsedDate.getTime()) ? '' : parsedDate.toLocaleDateString('zh-TW', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                        }).replace(/\//g, '-').replace(/^(\d{4})-(\d{2})-(\d{2})$/, '$1-$2-$3');
                        
                        return {
                            ...log, 
                            'å®Œæ•´æ™‚é–“æˆ³è¨˜': fullTimestamp, 
                            'æ—¥æœŸ': datePart, 
                            'æ™‚é–“': extractTime(fullTimestamp), 
                        };
                    }).filter(log => log['æ—¥æœŸ'] && String(log['æ—¥æœŸ']).trim() !== ''); 
                    
                    statusMessage.textContent = `è³‡æ–™è¼‰å…¥æˆåŠŸï¼å…± ${babyLogs.length} ç­†æœ€æ–°è¨˜éŒ„ã€‚`;
                    statusMessage.style.color = '#4CAF50'; 

                    // è‡ªå‹•è¨­å®šç‚ºä»Šå¤©
                    const today = new Date();
                    const formatDate = (date) => {
                           const y = date.getFullYear();
                           const m = String(date.getMonth() + 1).padStart(2, '0');
                           const d = String(date.getDate()).padStart(2, '0');
                           return `${y}-${m}-${d}`;
                    };
                    document.getElementById('start-date').value = formatDate(today);
                    document.getElementById('end-date').value = formatDate(today);

                    filterAndDisplayLogs();
                })
                .catch(error => {
                    statusMessage.textContent = 'é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ Apps Script è¨­å®šæ˜¯å¦æ­£ç¢ºã€‚';
                    console.error('Fetch Error:', error);
                });
        }


        // 2. ç¯©é¸èˆ‡é¡¯ç¤ºé‚è¼¯
        function filterAndDisplayLogs() {
            const outputDiv = document.getElementById('log-output');
            outputDiv.innerHTML = ''; 

            if (babyLogs.length === 0) {
                outputDiv.innerHTML = '<p>è³‡æ–™å°šæœªè¼‰å…¥æˆ–æ²’æœ‰è¨˜éŒ„ã€‚</p>';
                return;
            }

            const startDateStr = document.getElementById('start-date').value;
            const endDateStr = document.getElementById('end-date').value;

            if (!startDateStr || !endDateStr) {
                outputDiv.innerHTML = '<p>è«‹é¸æ“‡èµ·å§‹æ—¥æœŸå’ŒçµæŸæ—¥æœŸã€‚</p>';
                return; 
            }

            // ä½¿ç”¨ä¿®æ­£å¾Œçš„å‡½å¼ï¼Œç¢ºä¿å®ƒå€‘æ˜¯æœ¬åœ°æ™‚å€çš„ 00:00:00ï¼Œé¿å…æ™‚å€åç§»
            const startDate = parseDateForComparison(startDateStr);
            const endDate = parseDateForComparison(endDateStr);
            
            // çµæŸæ—¥æœŸçš„æ¯”è¼ƒç¯„åœæ˜¯åˆ° "çµæŸæ—¥æœŸçš„ä¸‹ä¸€å¤©çš„åˆå¤œ"
            if (endDate) {
                endDate.setDate(endDate.getDate() + 1); 
            }


            const filteredLogs = babyLogs.filter(log => {
                // å°‡è³‡æ–™åº«çš„æ™‚é–“æˆ³è¨˜è½‰æ›ç‚ºæ¯«ç§’æ•¸ï¼Œä»¥ä¾¿èˆ‡ç¯©é¸çš„æœ¬åœ°æ™‚é–“ç¯„åœæ¯”è¼ƒ
                const logTime = new Date(log['å®Œæ•´æ™‚é–“æˆ³è¨˜']).getTime(); 
                
                if (isNaN(logTime) || !startDate || !endDate) {
                    return false; 
                }

                // ç¯©é¸ï¼š logTime å¿…é ˆ >= èµ·å§‹æ—¥æœŸçš„æœ¬åœ°åˆå¤œ AND < çµæŸæ—¥æœŸçš„ä¸‹ä¸€å¤©çš„æœ¬åœ°åˆå¤œ
                return logTime >= startDate.getTime() && logTime < endDate.getTime();
            }).sort((a, b) => {
                const timeA = new Date(a['å®Œæ•´æ™‚é–“æˆ³è¨˜']).getTime();
                const timeB = new Date(b['å®Œæ•´æ™‚é–“æˆ³è¨˜']).getTime();
                return timeA - timeB; 
            });

            if (filteredLogs.length === 0) {
                outputDiv.innerHTML = '<p>åœ¨é¸å®šçš„æ—¥æœŸç¯„åœå…§æ²’æœ‰æ‰¾åˆ°æ—¥èªŒè¨˜éŒ„ã€‚</p>';
                return;
            }
            
            // 3. æ¸²æŸ“çµæœåˆ°ç¶²é 
            filteredLogs.forEach(log => {
                const card = document.createElement('div');
                card.className = 'log-card';

                const cardHeader = `
                    <div class="card-header">
                        <span>${log['æ—¥æœŸ']} ${extractTime(log['å®Œæ•´æ™‚é–“æˆ³è¨˜'])}</span>
                        <span class="date-time">æ“ä½œäººï¼š${log['æ‚¨çš„èº«åˆ†æ˜¯ï¼Ÿ'] || 'N/A'}</span>
                    </div>
                `;

                let contentHTML = '<div class="log-content">';
                let sectionContent = '';
                

                // A. é£²é£Ÿ/é¤µé£Ÿ (é»ƒè‰²ä¸»é¡Œ)
                sectionContent = '';
                if (log['æ—©é¤æ™‚é–“'] || log['åˆé¤æ™‚é–“'] || log['é»å¿ƒæ™‚é–“'] || log['å–å¥¶æ™‚é–“']) {
                    let foodDetails = [];

                    const breakfastMeal = log['æ—©é¤é¤é»'] || log['é¤é»(æ—©é¤)'] || log['æ—©é¤ é¤é»'] || (log['æ—©é¤æ™‚é–“'] ? log['é¤é»'] : undefined);
                    if (log['æ—©é¤æ™‚é–“']) foodDetails.push({ time: extractTime(log['æ—©é¤æ™‚é–“']), label: "æ—©é¤", food: breakfastMeal });
                    
                    const lunchMeal = log['åˆé¤é¤é»'] || log['é¤é»(åˆé¤)'] || log['åˆé¤ é¤é»'] || (log['åˆé¤æ™‚é–“'] ? log['é¤é» 1'] : undefined);
                    if (log['åˆé¤æ™‚é–“']) foodDetails.push({ time: extractTime(log['åˆé¤æ™‚é–“']), label: "åˆé¤", food: lunchMeal });
                    
                    const snackMeal = log['é»å¿ƒé¤é»'] || log['é¤é»(é»å¿ƒ)'] || log['é»å¿ƒ é¤é»'] || (log['é»å¿ƒæ™‚é–“'] ? log['é¤é» 2'] : undefined);
                    if (log['é»å¿ƒæ™‚é–“']) foodDetails.push({ time: extractTime(log['é»å¿ƒæ™‚é–“']), label: "é»å¿ƒ", food: snackMeal });

                    if (log['å–å¥¶æ™‚é–“']) {
                        foodDetails.push({ time: extractTime(log['å–å¥¶æ™‚é–“']), label: "å–å¥¶", amount: log['å¥¶é‡(cc)'], isMilk: true });
                    }
                    
                    if (foodDetails.length > 0) {
                        sectionContent = foodDetails.map(f => {
                            let foodDisplay = f.food && String(f.food).trim() !== '' ? ` (${f.food})` : '';
                            
                            return `
                                <div class="detail-row">
                                    <div class="detail-item">
                                        <strong>${f.label}:</strong> ${f.time}${foodDisplay}
                                    </div>
                                    ${f.isMilk ? 
                                        `<div class="detail-item"><strong>å¥¶é‡:</strong> ${f.amount || 'N/A'} cc</div>` : 
                                        ''
                                    }
                                </div>
                            `;
                        }).join('');

                        contentHTML += `<div class="log-section feeding-theme">
                            <h4><span>ğŸ¼</span> é£²é£Ÿè¨˜éŒ„</h4>${sectionContent}
                        </div>`;
                    }
                // çµæ§‹ 1: å¤šæ¬¡é£²é£Ÿ (èˆŠçµæ§‹) - å‚™ç”¨
                } else if (log['ç¬¬ä¸€æ¬¡ é£²é£Ÿ'] || log['ç¬¬äºŒæ¬¡ é£²é£Ÿ'] || log['ç¬¬ä¸‰æ¬¡ é£²é£Ÿ']) {
                    let feedingDetails = [];
                    if (log['ç¬¬ä¸€æ¬¡ é£²é£Ÿ']) feedingDetails.push({ time: extractTime(log['ç¬¬ä¸€æ¬¡ é£²é£Ÿ']), label: "ç¬¬ä¸€æ¬¡é¤µé£Ÿ", amount: log['å¥¶é‡(cc)'], other: log['å…¶ä»–é£²é£Ÿ'] });
                    if (log['ç¬¬äºŒæ¬¡ é£²é£Ÿ']) feedingDetails.push({ time: extractTime(log['ç¬¬äºŒæ¬¡ é£²é£Ÿ']), label: "ç¬¬äºŒæ¬¡é¤µé£Ÿ", amount: log['ç¬¬äºŒæ¬¡ é£²é£Ÿå¥¶é‡(cc)'], other: log['ç¬¬äºŒæ¬¡ é£²é£Ÿå…¶ä»–é£²é£Ÿ'] });
                    if (log['ç¬¬ä¸‰æ¬¡ é£²é£Ÿ']) feedingDetails.push({ time: extractTime(log['ç¬¬ä¸‰æ¬¡ é£²é£Ÿ']), label: "ç¬¬ä¸‰æ¬¡é¤µé£Ÿ", amount: log['ç¬¬ä¸‰æ¬¡ é£²é£Ÿå¥¶é‡(cc)'], other: log['ç¬¬ä¸‰æ¬¡ é£²é£Ÿå…¶ä»–é£²é£Ÿ'] });

                    sectionContent = feedingDetails.map(f => `
                        <div class="detail-row">
                            <div class="detail-item"><strong>${f.label}:</strong> ${f.time}</div>
                            <div class="detail-item"><strong>å¥¶é‡:</strong> ${f.amount || 'N/A'} cc</div>
                            ${f.other && String(f.other).trim() !== '' ? `<div class="detail-item"><strong>å…¶ä»–é£²é£Ÿ:</strong> ${f.other}</div>` : ''}
                        </div>
                    `).join('');
                    
                    contentHTML += `<div class="log-section feeding-theme">
                        <h4><span>ğŸ¼</span> é£²é£Ÿè¨˜éŒ„ (å¤šé¤æ¬¡çµæ§‹)</h4>${sectionContent}
                    </div>`;
                }

                // B. ç¡çœ  (è—è‰²ä¸»é¡Œ) - **å·²ä¿®æ”¹**
                sectionContent = '';
                if (log['ç¬¬ä¸€æ¬¡ ç¡çœ '] || log['ç¬¬äºŒæ¬¡ ç¡çœ '] || log['ç¬¬ä¸‰æ¬¡ ç¡çœ ']) {
                    if (log['ç¬¬ä¸€æ¬¡ ç¡çœ ']) sectionContent += `<div class="detail-item"><strong>ç¬¬ä¸€æ¬¡:</strong> ${extractTime(log['ç¬¬ä¸€æ¬¡ ç¡çœ '])} (${log['ç¬¬ä¸€æ¬¡ç¡çœ ç‹€æ³'] || 'N/A'})</div>`;
                    if (log['ç¬¬äºŒæ¬¡ ç¡çœ ']) sectionContent += `<div class="detail-item"><strong>ç¬¬äºŒæ¬¡:</strong> ${extractTime(log['ç¬¬äºŒæ¬¡ ç¡çœ '])} (${log['ç¬¬äºŒæ¬¡ç¡çœ ç‹€æ³'] || 'N/A'})</div>`;
                    if (log['ç¬¬ä¸‰æ¬¡ ç¡çœ ']) sectionContent += `<div class="detail-item"><strong>ç¬¬ä¸‰æ¬¡:</strong> ${extractTime(log['ç¬¬ä¸‰æ¬¡ ç¡çœ ']) || 'N/A'}</div>`;
                    
                    contentHTML += `<div class="log-section sleeping-theme">
                        <h4><span>ğŸ˜´</span> ç¡çœ ç‹€æ³</h4><div class="detail-row">${sectionContent}</div>
                    </div>`;
                }
                
                // C. æ’ä¾¿/æ¸…æ½” (ç¶ è‰²ä¸»é¡Œ) - **å·²ä¿®æ”¹**
                sectionContent = '';
                if (log['ç¬¬ä¸€æ¬¡ æ’ä¾¿'] || log['æ´—æ¾¡æ™‚é–“'] || log['æ›å°¿å¸ƒæ™‚é–“']) {
                    if (log['ç¬¬ä¸€æ¬¡ æ’ä¾¿']) sectionContent += `<div class="detail-item"><strong>æ’ä¾¿ 1:</strong> ${extractTime(log['ç¬¬ä¸€æ¬¡ æ’ä¾¿'])} (${log['ç¬¬ä¸€æ¬¡æ’ä¾¿ç‹€æ…‹'] || 'N/A'})</div>`;
                    if (log['ç¬¬äºŒæ¬¡ æ’ä¾¿']) sectionContent += `<div class="detail-item"><strong>æ’ä¾¿ 2:</strong> ${extractTime(log['ç¬¬äºŒæ¬¡ æ’ä¾¿'])} (${log['ç¬¬äºŒæ¬¡æ’ä¾¿ç‹€æ…‹'] || 'N/A'})</div>`;
                    if (log['ç¬¬ä¸‰æ¬¡ æ’ä¾¿']) sectionContent += `<div class="detail-item"><strong>æ’ä¾¿ 3:</strong> ${extractTime(log['ç¬¬ä¸‰æ¬¡ æ’ä¾¿']) || 'N/A'} (${log['ç¬¬ä¸‰æ¬¡ æ’ä¾¿ç‹€æ…‹'] || 'N/A'})</div>`;
                    
                    if (log['æ’ä¾¿éå¤šæ¬¡æ•¸(æ¬¡)']) sectionContent += `<div class="detail-item"><strong>éå¤šæ¬¡æ•¸:</strong> ${log['æ’ä¾¿éå¤šæ¬¡æ•¸(æ¬¡)']} æ¬¡</div>`;
                    if (log['æ›å°¿å¸ƒæ™‚é–“']) sectionContent += `<div class="detail-item"><strong>æ›å°¿å¸ƒ:</strong> ${extractTime(log['æ›å°¿å¸ƒæ™‚é–“']) || 'N/A'}</div>`;
                    if (log['æ´—æ¾¡æ™‚é–“']) sectionContent += `<div class="detail-item"><strong>æ´—æ¾¡:</strong> ${extractTime(log['æ´—æ¾¡æ™‚é–“']) || 'N/A'}</div>`;
                    if (log['å£è…”æ¸…æ½”æˆ–åˆ·ç‰™æ™‚é–“']) sectionContent += `<div class="detail-item"><strong>å£è…”æ¸…æ½”:</strong> ${extractTime(log['å£è…”æ¸…æ½”æˆ–åˆ·ç‰™æ™‚é–“']) || 'N/A'}</div>`;
                    
                    contentHTML += `<div class="log-section diaper-theme">
                        <h4><span>ğŸš½</span> æ¸…æ½”èˆ‡æ’æ³„</h4><div class="detail-row">${sectionContent}</div>
                    </div>`;
                }


                // D. é«”æº«/æƒ…ç·’/æ„å¤– (ç´…è‰²ä¸»é¡Œ)
                sectionContent = '';
                // æª¢æŸ¥é«”æº«æ¬„ä½
                if (log['é«”æº«'] && String(log['é«”æº«']).trim() !== '' && log['é«”æº«'] !== 'N/A') {
                    sectionContent += `<div class="detail-item"><strong>é«”æº«:</strong> ${log['é«”æº«']}Â°C</div>`;
                } else if (log['é«”æº« ä¸Šåˆ'] || log['é«”æº« ä¸­åˆ'] || log['é«”æº« ä¸‹åˆ'] || log['é«”æº« æ™šä¸Š']) {
                    sectionContent += `<div class="detail-item"><strong>ä¸Šåˆ:</strong> ${log['é«”æº« ä¸Šåˆ'] || 'N/A'}Â°C</div>`;
                    sectionContent += `<div class="detail-item"><strong>ä¸­åˆ:</strong> ${log['é«”æº« ä¸­åˆ'] || 'N/A'}Â°C</div>`;
                    sectionContent += `<div class="detail-item"><strong>ä¸‹åˆ:</strong> ${log['é«”æº« ä¸‹åˆ'] || 'N/A'}Â°C</div>`;
                    sectionContent += `<div class="detail-item"><strong>æ™šä¸Š:</strong> ${log['é«”æº« æ™šä¸Š'] || 'N/A'}Â°C</div>`;
                }
                
                if (log['å¯¶å¯¶æƒ…ç·’'] || log['èº«é«”ç‹€æ³'] || log['æ„å¤–ç‹€æ³'] || sectionContent !== '') {
                    
                    contentHTML += `<div class="log-section health-theme">
                        <h4><span>ğŸŒ¡ï¸</span> é«”æº«èˆ‡ç‹€æ…‹</h4>
                        
                        <div class="detail-row">${sectionContent}</div>
                        
                        <div class="detail-row">
                            <div class="detail-item"><strong>å¯¶å¯¶æƒ…ç·’:</strong> ${log['å¯¶å¯¶æƒ…ç·’'] || 'N/A'}</div>
                        </div>
                        
                        <div class="detail-row">
                            ${log['èº«é«”ç‹€æ³'] && String(log['èº«é«”ç‹€æ³']).trim() !== '' ? `<div class="detail-item"><strong>èº«é«”ç‹€æ³:</strong> ${log['èº«é«”ç‹€æ³']}</div>` : ''}
                            ${log['æ„å¤–ç‹€æ³'] && String(log['æ„å¤–ç‹€æ³']).trim() !== '' ? `<div class="detail-item"><strong>æ„å¤–ç‹€æ³:</strong> ${log['æ„å¤–ç‹€æ³']}</div>` : ''}
                        </div>
                    </div>`;
                }

                // E. è¯çµ¡äº‹é …èˆ‡å›é¥‹ (ç°è‰²ä¸»é¡Œ) - å·²åŠ å…¥ã€Œå¯¶å¯¶æ´»å‹•ç‹€æ³ã€
                if (log['è¤“å§†è¯çµ¡äº‹é …'] || log['å°æ–¼ä»Šæ—¥å¯¶å¯¶ç‹€æ³åˆ†äº«èˆ‡å›é¥‹'] || log['å¯¶å¯¶æ´»å‹•ç‹€æ³']) {
                    sectionContent = '';
                    
                    // 1. æ´»å‹•ç‹€æ³ (å·²ç§»åˆ°é€™è£¡)
                    if (log['å¯¶å¯¶æ´»å‹•ç‹€æ³'] && String(log['å¯¶å¯¶æ´»å‹•ç‹€æ³']).trim() !== '') {
                        sectionContent += `<div class="detail-row"><div class="detail-item"><strong>å¯¶å¯¶æ´»å‹•ç‹€æ³:</strong> ${log['å¯¶å¯¶æ´»å‹•ç‹€æ³']}</div></div>`;
                    }
                    
                    // 2. è¤“å§†è¯çµ¡äº‹é …
                    if (log['è¤“å§†è¯çµ¡äº‹é …'] && String(log['è¤“å§†è¯çµ¡äº‹é …']).trim() !== '') {
                        sectionContent += `<div class="detail-row"><div class="detail-item"><strong>è¤“å§†è¯çµ¡äº‹é …:</strong> ${log['è¤“å§†è¯çµ¡äº‹é …']}</div></div>`;
                    }
                    
                    // 3. å®¶é•·å›é¥‹
                    if (log['å°æ–¼ä»Šæ—¥å¯¶å¯¶ç‹€æ³åˆ†äº«èˆ‡å›é¥‹'] && String(log['å°æ–¼ä»Šæ—¥å¯¶å¯¶ç‹€æ³åˆ†äº«èˆ‡å›é¥‹']).trim() !== '') {
                        sectionContent += `<div class="detail-row"><div class="detail-item"><strong>å®¶é•·å›é¥‹:</strong> ${log['å°æ–¼ä»Šæ—¥å¯¶å¯¶ç‹€æ³åˆ†äº«èˆ‡å›é¥‹']}</div></div>`;
                    }
                    
                    contentHTML += `<div class="log-section contact-theme">
                        <h4><span>ğŸ“</span> è¯çµ¡èˆ‡å›é¥‹</h4>${sectionContent}
                    </div>`;
                }
                

                contentHTML += '</div>'; // é—œé–‰ log-content

                card.innerHTML = cardHeader + contentHTML;
                outputDiv.appendChild(card);
            });
        }

        document.addEventListener('DOMContentLoaded', loadBabyLogs);
    </script>
</body>
</html>
